<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NewAge - Focus Lockdown</title>
    <style>
        /* Твій існуючий CSS залишається без змін */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #000; overflow: hidden; touch-action: none; user-select: none; }
        #game-wrapper { width: 1280px; height: 720px; position: absolute; transform-origin: 0 0; will-change: transform; background: #000; transition: transform 0.2s ease-out; }
        #ruffle-container, ruffle-player { width: 1280px !important; height: 720px !important; display: block; }
        ruffle-player::part(splash) { display: none !important; }
        #kbdBtn { position: fixed; bottom: 30px; right: 30px; z-index: 9999; width: 65px; height: 65px; border-radius: 50%; background: rgba(40, 40, 40, 0.9); color: white; border: 2px solid rgba(255, 255, 255, 0.4); font-size: 26px; display: flex; align-items: center; justify-content: center; touch-action: none; outline: none; -webkit-tap-highlight-color: transparent; }
        #kbdBtn.active { background: #27ae60; border-color: #fff; box-shadow: 0 0 20px #27ae60; }
    </style>
</head>
<body>

    <div id="game-wrapper">
        <div id="ruffle-container"></div>
    </div>
    
    <button id="kbdBtn" tabindex="-1">⌨️</button>

    <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>

    <script>
        // --- РЕЄСТРАЦІЯ SW ---
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(err => console.error('SW Error:', err));
        }

        const wrapper = document.getElementById('game-wrapper');
        const btn = document.getElementById('kbdBtn');
        let scale = 1, baseScale = 1, tx = 0, ty = 0, isKeyboardActive = false;

        function apply() {
            const viewW = window.innerWidth;
            const viewH = window.innerHeight;
            const gameW = 1280 * scale;
            const gameH = 720 * scale;
            let fTx = (gameW <= viewW) ? (viewW - gameW) / 2 : Math.max(viewW - gameW, Math.min(tx, 0));
            let fTy = isKeyboardActive ? (viewH - gameH) : ((gameH <= viewH) ? (viewH - gameH) / 2 : Math.max(viewH - gameH, Math.min(ty, 0)));
            wrapper.style.transform = `translate3d(${fTx}px, ${fTy}px, 0) scale(${scale})`;
        }

        function initScale() {
            baseScale = Math.min(window.innerWidth / 1280, window.innerHeight / 720);
            if (!isKeyboardActive) {
                scale = baseScale;
                tx = (window.innerWidth - 1280 * scale) / 2;
                ty = (window.innerHeight - 720 * scale) / 2;
            }
            apply();
        }

        // --- ЛОГІКА ІНІЦІАЛІЗАЦІЇ RUFFLE ---
        window.RufflePlayer = window.RufflePlayer || {};
        window.RufflePlayer.config = { 
            "splashScreen": false, 
            "quality": "low", 
            "preferredRenderer": "webgl",
            "allowNetworking": "all" // Важливо для доступу до бази
        };

        window.addEventListener("load", () => {
            const ruffle = window.RufflePlayer.newest();
            if (!ruffle) {
                console.error("Ruffle не знайдено! Перевір інтернет або шлях до скрипта.");
                return;
            }

            const player = ruffle.createPlayer();
            const container = document.getElementById("ruffle-container");
            container.appendChild(player);

            player.load({
                url: "game.swf",
                parameters: "",
                allowScriptAccess: true
            }).then(() => {
                console.log("SWF завантажено успішно");
                player.tabIndex = -1;
                setTimeout(initScale, 200);
            }).catch((err) => {
                console.error("Помилка завантаження Ruffle:", err);
            });
        });

        // Твоя логіка зуму та кнопки залишається без змін...
        window.addEventListener('resize', apply);
        // ... (інший код зуму)
    </script>
</body>
</html>